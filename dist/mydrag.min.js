!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Mydrag=i()}(this,(function(){"use strict";var t=function(i,e){return new t.fn.init(i,e)};return t.config={adsorb:!0,rate:5,initX:0,initY:0,gap:10},t.events={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",RESIZE:"resize"},t.fn=t.prototype={constructor:t,init:function(t,i){this.elem=document.querySelector(t),this.rect=null,this.config=this.mergeConfig(i),this.winW=this.getWin().width,this.winH=this.getWin().height,this.initX=0,this.initY=0,this.oldX=0,this.oldY=0,this.newX=0,this.newY=0,this.x=0,this.y=0,this.limit={l:0,r:0,t:0,b:0},this.gap=this.config.gap,this.areaId=0,this.isTouching=!1,this.initData(),this.addListening()},initData:function(){this.rect=this.elem.getBoundingClientRect(),this.limit.l=this.gap,this.limit.r=this.winW-this.rect.width-this.gap,this.limit.t=this.gap,this.limit.b=this.winH-this.rect.height-this.gap;var i=this.config.initX,e=this.config.initY;(i<this.gap||i>this.limit.r)&&(i=t.config.initX+this.gap),(e<this.gap||e>this.limit.b)&&(e=t.config.initY+this.gap),this.initX=this.oldX=this.newX=i,this.initY=this.oldY=this.newY=e,this.setPos(i,e)},addListening:function(){var t=this.detectPassive();this.elem.addEventListener("touchstart",this),this.elem.addEventListener("touchmove",this,t),this.elem.addEventListener("touchend",this),window.addEventListener("resize",this)},removeListener:function(){this.elem.removeEventListener("touchstart",this.touchStart),this.elem.removeEventListener("touchmove",this.touchMove),this.elem.removeEventListener("touchend",this.touchEnd),window.removeEventListener("resize",this.resize)},handleEvent:function(i){return function(t,e){switch(t){case e.TOUCH_START:this.touchStart(i);break;case e.TOUCH_MOVE:this.touchMove(i);break;case e.TOUCH_END:this.touchEnd(i);break;case e.RESIZE:this.resize()}}.bind(this)(i.type,t.events)},touchStart:function(t){t.cancelable&&t.preventDefault();var i=t.touches&&t.touches[0]||t;this.isTouching=!0,this.newX&&(this.initX=this.newX),this.newY&&(this.initY=this.newY),this.oldX=i.clientX,this.oldY=i.clientY},touchMove:function(t){if(this.isTouching){t.cancelable&&t.preventDefault();var i=t.touches&&t.touches[0]||t,e=i.clientX-this.oldX,s=i.clientY-this.oldY;this.x=this.initX+e,this.y=this.initY+s,this.setPos(this.x,this.y),this.newX=this.x,this.newY=this.y,this.detectEdge(),this.detectArea()}},touchEnd:function(){if(this.isTouching&&(this.isTouching=!1,this.removeListener(),this.config.adsorb)){var t=this.limit.l,i=this.limit.r,e=this.areaId,s=this.config.rate,n=0===e?t:1===e?i:this.x,h=function(){if(!this.isTouching){var t=this.easeout(this.x,n,s);void 0!==t?(this.x=t,this.newX=t,this.setPos(this.x,this.y),requestAnimationFrame(h)):this.newX=n}}.bind(this);h()}},resize:function(){this.winW=this.getWin().width,this.winH=this.getWin().height,this.initData()},detectArea:function(){var t=this.winW/2,i=this.x+this.rect.width/2;this.areaId=i<t?0:1},detectEdge:function(){var t=!1,i=this.x,e=i+this.rect.width,s=this.y,n=s+this.rect.height;i<=this.gap&&(t=!0,this.x=this.limit.l),e>=this.winW-this.gap&&(t=!0,this.x=this.limit.r),s<=this.gap&&(t=!0,this.y=this.limit.t),n>=this.winH-this.gap&&(t=!0,this.y=this.limit.b),t&&this.setPos(this.x,this.y)},setPos:function(t,i){var e=[Math.round(1e3*t)/1e3+"px",Math.round(1e3*i)/1e3+"px",0].join(",");this.elem.style.transform="translate3d("+e+")"},easeout:function(t,i,e){if(t!==i){var s=t||0,n=i||0;return s+=(n-s)/(e||5),Math.abs(n-s)<1?n:s}},detectPassive:function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){return t=!0,!0}});window.addEventListener("test",null,i),window.removeEventListener("test",null)}catch(t){}return!!t&&{passive:!1}},mergeConfig:function(i){var e={},s=t.config;for(var n in s)i&&void 0!==i[n]?e[n]=i[n]:e[n]=s[n];return e},getWin:function(){var t=window.document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}},t.fn.init.prototype=t.fn,t}));
