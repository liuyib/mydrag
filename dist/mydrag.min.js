!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Mydrag=i()}(this,(function(){"use strict";function t(t){return"number"==typeof t}function i(){var t=window.document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}var e=function(t,i){return new e.fn.init(t,i)};return e.config={adsorb:!0,rate:5,initX:0,initY:0,gap:10},e.events={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",RESIZE:"resize"},e.fn=e.prototype={constructor:e,init:function(t,s){this.elem=document.querySelector(t),this.elem?(this.storeKey=t,this.rect=null,this.config=function(t,i){var e={};for(var s in t)i&&void 0!==i[s]?e[s]=i[s]:e[s]=t[s];return e}(e.config,s),this.winW=i().width,this.winH=i().height,this.initX=0,this.initY=0,this.oldX=0,this.oldY=0,this.newX=0,this.newY=0,this.x=0,this.y=0,this.limit={l:0,r:0,t:0,b:0},this.gap=this.config.gap,this.isLeftArea=!0,this.isTouching=!1,this.initData(),this.addListening()):console.error('Unable to find element by selector "'+t+'"')},initData:function(){this.rect=this.elem.getBoundingClientRect(),this.limit.l=this.gap,this.limit.r=this.winW-this.rect.width-this.gap,this.limit.t=this.gap,this.limit.b=this.winH-this.rect.height-this.gap;var t=this.config.initX,i=this.config.initY;(t<this.gap||t>this.limit.r)&&(t=e.config.initX+this.gap),(i<this.gap||i>this.limit.b)&&(i=e.config.initY+this.gap),this.initX=this.oldX=this.newX=t,this.initY=this.oldY=this.newY=i,this.setPos(t,i),this.gainPos()},addListening:function(){var t=function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){return t=!0,!0}});window.addEventListener("test",null,i),window.removeEventListener("test",null)}catch(t){}return!!t&&{passive:!1}}();this.elem.addEventListener("touchstart",this),this.elem.addEventListener("touchmove",this,t),this.elem.addEventListener("touchend",this),window.addEventListener("resize",this)},removeListener:function(){this.elem.removeEventListener("touchstart",this.touchStart),this.elem.removeEventListener("touchmove",this.touchMove),this.elem.removeEventListener("touchend",this.touchEnd),window.removeEventListener("resize",this.resize)},handleEvent:function(t){return function(i,e){switch(i){case e.TOUCH_START:this.touchStart(t);break;case e.TOUCH_MOVE:this.touchMove(t);break;case e.TOUCH_END:this.touchEnd(t);break;case e.RESIZE:this.resize()}}.bind(this)(t.type,e.events)},touchStart:function(t){t.cancelable&&t.preventDefault();var i=t.touches?t.touches[0]:t;this.isTouching=!0,this.newX&&(this.initX=this.newX),this.newY&&(this.initY=this.newY),this.oldX=i.clientX,this.oldY=i.clientY},touchMove:function(t){if(this.isTouching){t.cancelable&&t.preventDefault();var i=t.touches?t.touches[0]:t,e=i.clientX-this.oldX,s=i.clientY-this.oldY;this.x=this.initX+e,this.y=this.initY+s,this.detectEdge(),this.detectArea(),this.setPos(this.x,this.y),this.newX=this.x,this.newY=this.y}},touchEnd:function(){if(this.isTouching)if(this.isTouching=!1,this.removeListener(),this.config.adsorb){var i=0;i=this.isLeftArea?this.limit.l:this.limit.r;var e=function(){if(!this.isTouching){var s=function(i,e,s,n){if(i!==e){var h=t(i)&&i||0,o=t(e)&&e||0,r=t(s)&&s||5,a=t(n)&&n||.2;return h+=(o-h)/r,Math.abs(o-h)<a?o:h}}(this.x,i,this.config.rate);void 0!==s?(this.x=s,this.newX=s,this.setPos(this.x,this.y),requestAnimationFrame(e)):(this.newX=i,this.savePos())}}.bind(this);e()}else this.savePos()},resize:function(){this.winW=i().width,this.winH=i().height,this.initData()},detectArea:function(){var t=this.winW/2,i=this.x+this.rect.width/2;this.isLeftArea=i<t},detectEdge:function(){var t=!1,i=this.x,e=i+this.rect.width,s=this.y,n=s+this.rect.height;i<=this.gap&&(t=!0,this.x=this.limit.l),e>=this.winW-this.gap&&(t=!0,this.x=this.limit.r),s<=this.gap&&(t=!0,this.y=this.limit.t),n>=this.winH-this.gap&&(t=!0,this.y=this.limit.b),t&&this.setPos(this.x,this.y)},setPos:function(t,i){var e=[Math.round(1e3*t)/1e3+"px",Math.round(1e3*i)/1e3+"px"].join(",");this.elem.style.transform="translate("+e+")"},savePos:function(){var t=parseInt(this.x,10),i=parseInt(this.y,10);localStorage.setItem("Mydarg_"+this.storeKey+"_x",t),localStorage.setItem("Mydarg_"+this.storeKey+"_y",i)},gainPos:function(){var t=localStorage.getItem("Mydarg_"+this.storeKey+"_x"),i=localStorage.getItem("Mydarg_"+this.storeKey+"_y");null!==t&&(this.newX=parseInt(t,10)),null!==i&&(this.newY=parseInt(i,10)),this.setPos(this.newX,this.newY)}},e.fn.init.prototype=e.fn,e}));
